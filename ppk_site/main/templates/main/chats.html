{% extends 'main/layout.html' %}

{% block title %}
{{ title }}
{% endblock %}

{% block content %}

<div class="row justify-content-center">
    <div class="col-md-auto">
        <h1>Тех-поддержка</h1>
    </div>
</div>

{% if request.user.is_authenticated %}


<div class="row">
    <div class="col-sm-9">
        <div class="row">
            {% for user_form in user_forms  %}

            <div class="col-sm-4 p-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-start flex-column">
                        <h5 class="card-title mb-auto">{{ user_form.user.username }}</h5>

                        {% if user_form.chat_exists %}

                        <a href="{% url 'chat-detail' user_form.user.id %}" class="btn btn-primary bg-main-ppk mt-3">Открыть чат</a>

                        {% else %}

                        <form method="post" action="{% url 'create_chat' %}">
                            {% csrf_token %}
                            {{ user_form.form.as_p }}
                            <button class="btn btn-primary bg-main-ppk mt-3" type="submit">Создать чат</button>
                        </form>

                        {% endif %}

                    </div>
                </div>
            </div>

            {% endfor %}
        </div>
        {% if chats|length != 0 %}
        <div class="row justify-content-center">
            <div class="col-md-auto">
                <h3>Активные чаты</h3>
            </div>
        </div>

        {% endif %}
         <div class="row">
            {% for chat in chats %}

            <div class="col-sm-4 p-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-start flex-column">
                        <form method="post">
                            {% csrf_token %}
                            {{ form.user_owner }}
                            <h5 class="card-title mb-auto">{{ chat.user_owner.username }}</h5>
                            <button class="btn btn-primary bg-main-ppk mt-3" type="submit"></button>
                        </form>
                    </div>
                </div>
            </div>

            {% endfor %}
        </div>
    </div>
    <div class="col-sm-3">
        {% include 'main/banner.html' %}
    </div>

</div>


{% else %}

<div class="row justify-content-center">
    <div class="col-md-auto">
        <h3>Требуется авторизация</h3>
    </div>
</div>

{% endif %}

{% endblock %}